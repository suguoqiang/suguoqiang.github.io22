<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="gqsu"><meta name="copyright" content="gqsu"><title>笔记 | 技术笔记分享</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?060ae9ba8fa5be868a3d10fdf6f65af4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="http://gallery.gqsu.top/favicon.png"></div><div class="author-info__name text-center">gqsu</div><div class="author-info__description text-center"></div><div class="follow-button"><a href="http://gqsu.top" target="_blank" rel="noopener">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">164</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">39</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">33</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">友链</div><a class="author-info-links__name text-center" href="https://xclient.info/" target="_blank" rel="noopener">mac</a><a class="author-info-links__name text-center" href="http://cron.qqe2.com/" target="_blank" rel="noopener">cron</a><a class="author-info-links__name text-center" href="https://www.bootschool.net/ascii" target="_blank" rel="noopener">banner</a><a class="author-info-links__name text-center" href="https://www.easyice.cn/" target="_blank" rel="noopener">easyice</a><a class="author-info-links__name text-center" href="http://springcloud.fun/" target="_blank" rel="noopener">springCloud-cn</a><a class="author-info-links__name text-center" href="https://greasyfork.org/zh-CN" target="_blank" rel="noopener">Greasy Fork</a><a class="author-info-links__name text-center" href="https://aotu.io/" target="_blank" rel="noopener">凹凸实验室</a><a class="author-info-links__name text-center" href="https://tgideas.qq.com/#/hot" target="_blank" rel="noopener">腾讯互娱</a><a class="author-info-links__name text-center" href="http://taobaofed.org/" target="_blank" rel="noopener">淘宝FED</a><a class="author-info-links__name text-center" href="http://fex.baidu.com/" target="_blank" rel="noopener">百度FEX</a></div></div></div><nav id="nav" style="background-image: url(http://gallery.gqsu.top/header.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">技术笔记分享</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a><a class="site-page" href="/about">关于我</a><a class="site-page" href="/gallery">相册</a><a class="site-page" href="/slides">时光轴</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">技术笔记分享</div><div id="site-sub-title">笔记</div><div id="site-social-icons"><a class="social-icon" href="https://github.com/suguoqiang" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-github fa"></i></a><a class="social-icon" href="https://weibo.com/2498796682/profile?topnav=1&amp;wvr=6" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-weibo fa"></i></a><a class="social-icon" href="https://Molunerfinn/atom.xml" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-rss fa"></i></a><a class="social-icon" href="http://gallery.gqsu.top/wechat_me.jpg" target="_blank" rel="noreferrer noopener nofollow"><i class="fa-weixin fa"></i></a></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/23/linux-%E5%AE%89%E8%A3%85Maven%E3%80%81Jenkins/">linux-安装Jenkins，部署SpringBoot工程</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/linux/">linux</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/linux/">linux</a></span><div class="content"><h3 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h3><p>1、安装maven：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirror.bit.edu.cn/apache/maven/maven<span class="literal">-3</span>/<span class="number">3.5</span>.<span class="number">4</span>/binaries/apache<span class="literal">-maven</span><span class="literal">-3</span>.<span class="number">5.4</span><span class="literal">-bin</span>.tar.gz</span><br><span class="line"><span class="comment">## 解压</span></span><br><span class="line">tar vxf apache<span class="literal">-maven</span><span class="literal">-3</span>.<span class="number">5.0</span><span class="literal">-bin</span>.tar.gz</span><br><span class="line"><span class="comment">## 移动</span></span><br><span class="line">mv apache<span class="literal">-maven</span><span class="literal">-3</span>.<span class="number">5.0</span> /usr/local/maven3</span><br></pre></td></tr></table></figure>
<p>2、修改环境变量，在/etc/profile中添加：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">MAVEN_HOME</span>=<span class="string">/usr/local/maven3</span></span><br><span class="line"><span class="attr">export</span> <span class="string">MAVEN_HOME</span></span><br><span class="line"><span class="attr">export</span> <span class="string">PATH=$&#123;PATH&#125;:$&#123;MAVEN_HOME&#125;/bin</span></span><br></pre></td></tr></table></figure>
<p>3、执行<code>source /etc/profile</code>使环境变量生效。然后<code>mvn -v</code>查看是否安装成功。</p></div><a class="more" href="/2018/07/23/linux-%E5%AE%89%E8%A3%85Maven%E3%80%81Jenkins/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/20/study-linux%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%93%8D/">study--linux系统运维</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/study/">study</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/study/">study</a></span><div class="content"><h3 id="top命令查看系统使用情况"><a href="#top命令查看系统使用情况" class="headerlink" title="top命令查看系统使用情况"></a>top命令查看系统使用情况</h3><p>使用系统命令top即可看到如下类似信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">top - 15:14:11 up 17 days,  1:31,  4 users,  load average: 3.89, 12.82, 12.27</span><br><span class="line">Tasks: 213 total,   1 running, 207 sleeping,   0 stopped,   5 zombie</span><br><span class="line">%Cpu(s):  2.2 us,  1.5 sy,  0.0 ni, 96.2 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</span><br><span class="line">KiB Mem :  3788432 total,   138816 free,  3479284 used,   170332 buff&#x2F;cache</span><br><span class="line">KiB Swap:  2097148 total,   476760 free,  1620388 used.    62780 avail Mem</span><br></pre></td></tr></table></figure>

<p>第三行Cpu参数详解：</p>
<blockquote>
<p>us 用户空间占用CPU百分比；sy 内核空间占用CPU百分比；ni 用户进程空间内改变过优先级的进程占用CPU百分比；<br>id 空闲CPU百分比；wa 等待输入输出的CPU时间百分比；hi 硬件中断；si 软件中断；st: 实时；</p>
</blockquote></div><a class="more" href="/2018/07/20/study-linux%E8%BF%90%E7%BB%B4%E5%AE%9E%E6%93%8D/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/20/redis-%E7%BC%93%E5%AD%98/">redis缓存</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/redis/">redis</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/redis/">redis</a></span><div class="content"><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><blockquote>
<p>使用redis作为spring的缓存路径，支持spring cache的环境。以springBoot工程为例</p>
</blockquote>
<p>1、添加依赖和配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、配置redis文件,此处省略</p></div><a class="more" href="/2018/07/20/redis-%E7%BC%93%E5%AD%98/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/16/redis-2.%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E5%85%B6%E4%BB%96%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/">redis入门-2.五大数据类型介绍</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/redis/">redis</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/redis/">redis</a></span><div class="content"><h3 id="数据结构基础教程"><a href="#数据结构基础教程" class="headerlink" title="数据结构基础教程"></a>数据结构基础教程</h3><h4 id="String类型"><a href="#String类型" class="headerlink" title="String类型"></a>String类型</h4><blockquote>
<p>字符串最大长度为512M。 </p>
</blockquote>
<p>初始化字符串：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">set</span> ireader beijing.zhangyue.keji.gufen.youxian.gongsi</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>获取字符串内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> get ireader</span></span><br><span class="line">"beijing.zhangyue.keji.gufen.youxian.gongsi"</span><br></pre></td></tr></table></figure>
<p>获取字符串长度：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> strlen ireader</span></span><br><span class="line">(integer) 42</span><br></pre></td></tr></table></figure>
<p>获取子串：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> getrange ireader 28 34</span></span><br><span class="line">"youxian"</span><br></pre></td></tr></table></figure></div><a class="more" href="/2018/07/16/redis-2.%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E5%85%B6%E4%BB%96%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/16/springCloud-%E5%BC%80%E7%AF%87/">springCloud--开篇</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/springCloud/">springCloud</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springCloud/">springCloud</a></span><div class="content"><h3 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h3><h4 id="基本特点"><a href="#基本特点" class="headerlink" title="基本特点"></a>基本特点</h4><ul>
<li>1、通过服务实现组件化。开发者不再需要协调其它服务部署对本服务的影响。</li>
<li>2、按业务能力来划分服务和开发团队。开发者可以自由选择开发技术，提供 API 服务。</li>
<li>3、去中心化。</li>
</ul>
<p>每个微服务有自己私有的数据库持久化业务数据。<br>每个微服务只能访问自己的数据库，而不能访问其它服务的数据库。<br>某些业务场景下，需要在一个事务中更新多个数据库。这种情况也不能直接访问其它微服务的数据库，而是通过对于微服务进行操作。<br>数据的去中心化，进一步降低了微服务之间的耦合度，不同服务可以采用不同的数据库技术（SQL、NoSQL等）。在复杂的业务场景下，如果包含多个微服务，通常在客户端或者中间层（网关）处理。</p>
<ul>
<li>4、基础设施自动化（devops、自动化部署）。</li>
</ul>
<p>将应用拆分成为一个一个的单个服务，应用Docker技术，不依赖任何服务器和数据模型，是一个全栈应用，可以通过自动化方式独立部署，每个服务运行在自己的进程中，通过轻量的通讯机制联系，经常是基于HTTP资源API（RestFul API），这些服务基于业务能力构建，能实现集中化管理）。</p></div><a class="more" href="/2018/07/16/springCloud-%E5%BC%80%E7%AF%87/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/16/springCloud-%E6%96%AD%E8%B7%AF%E5%99%A8Hystrix/">springCloud--Hystrix断路器</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/springCloud/">springCloud</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springCloud/">springCloud</a></span><div class="content"><p>如果系统处于高并发的场景下，某一服务依赖于另外一服务，而另外一服务意外挂掉了，就需要用到Hystrix断路器。比如，购买商品的订单服务，当订单生成成功之后需要调用积分服务增加用户积分。如果积分服务挂了，我们可以暂时不更新积分，但是订单服务任要保证它可以正常工作，所以我们需要设定一个断路器（超时断开），保证订单服务正常运行，这个过程也称为降级。</p>
<p>添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Ribbon中引入Hystrix"><a href="#Ribbon中引入Hystrix" class="headerlink" title="Ribbon中引入Hystrix"></a>Ribbon中引入Hystrix</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span>   </span><br><span class="line">@EnableCircuitBreaker   #开启断路器功能</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RibbonApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@LoadBalanced</span></span><br><span class="line">	<span class="function">RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(RibbonApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><a class="more" href="/2018/07/16/springCloud-%E6%96%AD%E8%B7%AF%E5%99%A8Hystrix/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/16/springCloud-%E7%BD%91%E5%85%B3Zuul/">springCloud--网关zuul</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/springCloud/">springCloud</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springCloud/">springCloud</a></span><div class="content"><p>参考：<a href="https://blog.csdn.net/tianyaleixiaowu/article/details/77893822" target="_blank" rel="noopener">https://blog.csdn.net/tianyaleixiaowu/article/details/77893822</a></p>
<h3 id="服务过滤"><a href="#服务过滤" class="headerlink" title="服务过滤"></a>服务过滤</h3><p>在服务网关中定义过滤器只需要继承ZuulFilter抽象类实现其定义的四个抽象函数就可对请求进行拦截与过滤。</p>
<p>例子:定义了一个Zuul过滤器，实现了在请求被路由之前检查请求中是否有accessToken参数，若有就进行路由，若没有就拒绝访问，返回401 Unauthorized错误。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessFilter</span> <span class="keyword">extends</span> <span class="title">ZuulFilter</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger log = LoggerFactory.getLogger(AccessFilter<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">filterType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"pre"</span>; </span><br><span class="line">        <span class="comment">//枚举值：pre(请求被路由之前调⽤）, routing(请求时候被调⽤), post(在routing和error过滤器之后被调⽤), error(发⽣错误时被调⽤)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">filterOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//通过int值来定义过滤器的执⾏顺序</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//优先级， 0是最高优先级即最先执行</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//过滤器开关</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; <span class="comment">//写逻辑，是否需要执行过滤。true会执行run函数，false不执行run函数</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//过滤器的具体逻辑</span></span><br><span class="line">        RequestContext ctx = RequestContext.getCurrentContext();</span><br><span class="line">        HttpServletRequest request = ctx.getRequest();</span><br><span class="line"></span><br><span class="line">        log.info(String.format(<span class="string">"%s request to %s"</span>, request.getMethod(), request.getRequestURL().toString()));</span><br><span class="line"></span><br><span class="line">        Object accessToken = request.getParameter(<span class="string">"accessToken"</span>);</span><br><span class="line">        <span class="keyword">if</span>(accessToken == <span class="keyword">null</span>) &#123; </span><br><span class="line">            log.warn(<span class="string">"access token is empty"</span>);</span><br><span class="line">            <span class="comment">//过滤该请求，不往下级服务去转发请求，到此结束</span></span><br><span class="line">            ctx.setSendZuulResponse(<span class="keyword">false</span>);</span><br><span class="line">            ctx.setResponseStatusCode(<span class="number">401</span>);</span><br><span class="line">            ctx.setResponseBody(<span class="string">"&#123;\"result\":\"accessToken为空!\"&#125;"</span>);</span><br><span class="line">            ctx.getResponse().setContentType(<span class="string">"text/html;charset=UTF-8"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         <span class="comment">//如果有token，则进行路由转发</span></span><br><span class="line">        log.info(<span class="string">"access token ok"</span>);</span><br><span class="line">        <span class="comment">//这里return的值没有意义，zuul框架没有使用该返回值</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><a class="more" href="/2018/07/16/springCloud-%E7%BD%91%E5%85%B3Zuul/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/16/springCloud-%E7%BD%91%E5%85%B3gateway/">springCloud--网关gateway</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/springCloud/">springCloud</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/springCloud/">springCloud</a></span><div class="content"><h3 id="开始Gateway-限流"><a href="#开始Gateway-限流" class="headerlink" title="开始Gateway 限流"></a>开始Gateway 限流</h3><p>1、添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring cloud gateway依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--基于 reactive stream 的redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis-reactive<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、配置IP的限流请求</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">requestratelimiter_route</span>        <span class="comment">#路由的唯一id，不定义的话为一个uuid</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">lb://pigx-upms</span>            <span class="comment">#http请求为lb://前缀 + 服务id；ws请求为lb:ws://前缀 + 服务id；表示将请求负载到哪一个服务上。如果写成http://www.baidu.com默认是http请求</span></span><br><span class="line">        <span class="attr">order:</span> <span class="number">10000</span></span><br><span class="line">        <span class="attr">predicates:</span>                   <span class="comment">#路由的请求匹配规则</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Path=/admin/**</span>             </span><br><span class="line">        <span class="attr">filters:</span>                       <span class="comment">#请求转发前的filter</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RequestRateLimiter</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="attr">redis-rate-limiter.replenishRate:</span> <span class="number">1</span>  <span class="comment"># 令牌桶的容积</span></span><br><span class="line">            <span class="attr">redis-rate-limiter.burstCapacity:</span> <span class="number">3</span>  <span class="comment"># 流速 每秒</span></span><br><span class="line">            <span class="attr">key-resolver:</span> <span class="string">"#&#123;@remoteAddrKeyResolver&#125;"</span> <span class="comment">#SPEL表达式去的对应的bean</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">StripPrefix=1</span>               <span class="comment">#跳过第一个前缀(重要)</span></span><br></pre></td></tr></table></figure></div><a class="more" href="/2018/07/16/springCloud-%E7%BD%91%E5%85%B3gateway/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/07/15/redis-1.%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/">redis入门-1.基本概念</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/redis/">redis</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/redis/">redis</a></span><div class="content"><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>Redis是目前业界使用最广泛的内存数据存储。<br>相比memcached，Redis支持更丰富的数据结构，例如hashes, lists, sets等，同时支持数据持久化。<br>除此之外，Redis还提供一些类数据库的特性，比如事务，HA，主从库。<br>可以说Redis兼具了缓存系统和数据库的一些特性，因此有着丰富的应用场景。</p>
<p>在互联网场景下，尤其 2C 端大流量场景下，需要将一些经常展现和不会频繁变更的数据，存放在存取速率更快的地方。<br>缓存就是一个存储器，在技术选型中，常用 Redis 作为缓存数据库。</p>
<h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><p>以获取商品详情举例，说明缓存的优势：</p>
<p>a. 从商品 Cache 中获取商品详情，如果存在，则返回获取 Cache 数据返回。</p>
<p>b. 如果不存在，则从商品 DB 中获取。获取成功后，将数据存到 Cache 中。则下次获取商品详情，就可以从 Cache 就可以得到商品详情数据。</p>
<p>c. 从商品 DB 中更新或者删除商品详情成功后，则从缓存中删除对应商品的详情缓存<br><img src="http://cdn.gqsu.top/redis01-1.png" alt=""></p></div><a class="more" href="/2018/07/15/redis-1.%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/#more">阅读更多</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2018/06/28/rabbitmq-%E6%95%B4%E5%90%88SpringBoot/">rabbitmq--整合springBoot</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-06-28</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/rabbitmq-springBoot/">rabbitmq,springBoot</a></span><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/rabbitmq/">rabbitmq</a></span><div class="content"><h3 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h3><h4 id="1、队列、生产者、消费者"><a href="#1、队列、生产者、消费者" class="headerlink" title="1、队列、生产者、消费者"></a>1、队列、生产者、消费者</h4><p>队列（queue）是RabbitMQ的内部对象，用于存储消息。<br>生产者（proverder ），生产消息并投递到队列中。<br>消费者（consumer）可以从队列中获取消息并消费。如果有多个消费者，队列中的消息会平均分摊给各个消费者，而不是每个消费者能获取所有的队列消息并处理。</p>
<p>实际情况，一般是生产者绑定Exchange（交换机），通过指定一个Binding key，将Exchange与Queue绑定关联起来。<br>于是，生产者可以通过Routing key指定具体的路由规则，决定消息流向那个Queue中。Bindingkey与Rounting key一致才能取出该队列。</p>
<h4 id="2、Exchange交换机"><a href="#2、Exchange交换机" class="headerlink" title="2、Exchange交换机"></a>2、Exchange交换机</h4><p>RabbitMQ常用的Exchange Type有四种：fanout、direct、topic、headers 。</p>
<ul>
<li><p>direct：(默认方式)创建消息队列的时候,指定一个BindingKey。当发送者发送消息的时候,指定对应的Key。当Key和消息队列的BindingKey一致的时候,消息将会被发送到该消息队列中。先匹配，在投送。</p>
</li>
<li><p>topic：转发信息主要是依据通配符（<code>.</code>和<code>*</code>），队列和交换机的绑定主要是依据一种模式(通配符+字符串)，而当发送消息的时候，只有指定的Key和该模式相匹配的时候，消息才会被发送到该消息队列中。最为灵活的方式。</p>
</li>
<li><p>headers：队列和交换机的绑定的通过指定的一组键值对，而发送消息的时候也会指定一组键值对规则，当两组键值对规则相匹配的时候，消息会被发送到匹配的消息队列中。</p>
</li>
<li><p>fanout：把所有发送到该Exchange的消息投递到所有与它绑定的队列中，设置的任何Key此时都无效。消息广播方式。</p>
</li>
</ul>
<p>“quick.orange.rabbit”指定了两个队列 *.orange和 *.rabbit</p>
<p>简而言之，分为6种， 一对一生产消费模式，一对多生产消费模式、订阅发布模式、路由模式、主题模式、远程调用模式。<br><a href="https://mp.weixin.qq.com/s/0i88KR-7DaV7hruKOPlA2A" target="_blank" rel="noopener">参考</a></p></div><a class="more" href="/2018/06/28/rabbitmq-%E6%95%B4%E5%90%88SpringBoot/#more">阅读更多</a><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(http://gallery.gqsu.top/header.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2020 By gqsu</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="footer_custom_text">聚合优质内容，捕捉每个瞬间，细品生活滋味,体会百味人生. 小小的站有大大的梦!</div><div class="icp"><a href="http://www.beian.miit.gov.cn/" target="_blank" rel="noopener"><span>苏ICP备19072098号</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>